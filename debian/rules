#!/usr/bin/make -f

# Debian packaging rules for docker.io

export DH_VERBOSE = 1

%:
	dh $@

override_dh_auto_build:
	# Binaries are pre-built from GitHub releases
	# Nothing to build here

override_dh_auto_install:
	# Install Docker binaries to docker.io package
	install -D -m 0755 dockerd debian/docker.io/usr/bin/dockerd
	install -D -m 0755 docker-proxy debian/docker.io/usr/bin/docker-proxy

	# Install containerd binaries to containerd package
	install -D -m 0755 containerd debian/containerd/usr/bin/containerd
	install -D -m 0755 containerd-shim-runc-v2 debian/containerd/usr/bin/containerd-shim-runc-v2

	# Install runc binary to runc package
	install -D -m 0755 runc debian/runc/usr/bin/runc

	# Install Docker systemd service files
	install -D -m 0644 debian/docker.service debian/docker.io/lib/systemd/system/docker.service
	install -D -m 0644 debian/docker.socket debian/docker.io/lib/systemd/system/docker.socket

	# Install containerd systemd service file
	install -D -m 0644 debian/containerd.service debian/containerd/lib/systemd/system/containerd.service

	# Install Docker configuration example
	install -D -m 0644 debian/daemon.json debian/docker.io/etc/docker/daemon.json

override_dh_installdeb:
	dh_installdeb

override_dh_shlibdeps:
	dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info

override_dh_strip:
	# Don't strip binaries (already built)
	dh_strip --no-automatic-dbgsym

override_dh_dwz:
	# Skip dwz compression (binaries already built without debug symbols)
	# dwz fails on pre-built Go binaries
