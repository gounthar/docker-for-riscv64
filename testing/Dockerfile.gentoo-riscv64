# Gentoo RISC-V64 Test Environment
# Used for testing Docker overlay before real package builds
#
# Build: docker build -f testing/Dockerfile.gentoo-riscv64 -t gentoo-test:riscv64 .
# Run: docker run --rm -v $(pwd):/overlay gentoo-test:riscv64

# Note: Gentoo doesn't yet have official RISC-V64 stage3 tarballs in Docker Hub
# We'll use a minimal busybox-based approach to test the overlay structure
FROM busybox:1.36

# Install basic tools for testing
RUN mkdir -p /var/db/repos /etc/portage /usr/portage

# Simulate Gentoo environment
RUN echo "RISC-V64 Test Environment" > /etc/gentoo-release

WORKDIR /test

# Copy test scripts
COPY scripts/test-gentoo-integration.sh /test/
COPY scripts/benchmark-gentoo-docker.sh /test/

# Simulated equery for package verification
# Use build arg to make version configurable
ARG DOCKER_CLI_VERSION=28.5.1
RUN mkdir -p /usr/bin && \
    echo '#!/bin/sh' > /usr/bin/equery && \
    echo "echo \"app-containers/docker-cli-${DOCKER_CLI_VERSION}\"" >> /usr/bin/equery && \
    chmod +x /usr/bin/equery

CMD ["/bin/sh"]
