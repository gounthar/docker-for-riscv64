---
name: "Track cagent Go version requirement"

scms:
  cagent-upstream:
    kind: "github"
    spec:
      user: "docker"
      repository: "cagent"
      branch: "main"

sources:
  cagent-go-version:
    name: "Get Go version from cagent go.mod"
    kind: "file"
    scmid: "cagent-upstream"
    spec:
      file: "go.mod"
      matchpattern: '^go\s+(\d+\.\d+\.\d+)$'

conditions:
  check-go-version-format:
    name: "Validate Go version format"
    kind: "shell"
    spec:
      command: 'echo "{{ source "cagent-go-version" }}" | grep -E "^[0-9]+\.[0-9]+\.[0-9]+$"'

targets:
  update-cagent-workflow:
    name: "Update Go version in cagent weekly build workflow"
    kind: "yaml"
    sourceid: "cagent-go-version"
    spec:
      file: ".github/workflows/cagent-weekly-build.yml"
      key: "jobs.build-cagent.steps[1].with.go-version"

actions:
  default:
    kind: "github/pullrequest"
    scmid: "default"
    title: 'chore(ci): update cagent workflow Go version to {{ source "cagent-go-version" }}'
    spec:
      labels:
        - "dependencies"
        - "automation"
      description: |
        Automated update of Go version in cagent weekly build workflow.

        **cagent Go requirement:** `{{ source "cagent-go-version" }}`

        This PR updates the workflow to match the Go version required by cagent's go.mod file.

        Generated by UpdateCLI.
